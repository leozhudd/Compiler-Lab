## 编译实验之lab1：main与注释

18375123 朱穆清

这次实验比较有挑战性，要从头开始实现语法分析，以及重新实现一遍词法分析。助教提供的选项有自己手写词法分析和梯度下降，以及使用flex/bison/antlr等工具进行解析。我首先综合考虑了本课程后续任务量，和本学期其他众多课程的任务量，认为自己应该用最短的时间最高效的完成实验。此外也考虑到不要重复造轮子的理念，如果市面上已经有很成熟优化的很好的工具了的话，我要做的是学会如何充分利用它，而不是由自己写一个漏洞百出效率还不高的程序，还很花费时间。因此，我决定使用antlr作为本次实验词法分析和语法分析的工具。

antlr是一个开源的语法分析器，可以根据用户定义的语法规则来对字符串进行解析，生成一棵语法树，并很人性化的提供了遍历语法树的接口。俗话说，万事开头难。我首先查阅了网上的文档和一些博客，发现博客中写的内容很多都看不懂，什么visitor，listener都不知道是干什么的。我只能无奈先从看的懂得地方入手，先按照格式写好了词法和语法规则，并通过antlr提供的功能生成了语法树。这个语法树可以形象的告诉我哪里匹配上了，哪里没匹配上，我可以通过这些信息方便的对规则进行调试。

最后就是解决了如何遍历语法树的问题。我又去看了许多文档和博客，先试着自己用listerner进行遍历，但是写的时候感觉每个非终结符一进一出都要写一遍，很麻烦，于是就又找了找文档，换成了visitor的方法，访问谁就调用一次谁就够了。

就这样，我在遍历语法树的同时进行了llvm ir的转换。由于antlr的语法词法分析很结构化，未来的实验如果需要修改规则的话非常方便，只需要改配置文件而不用重新写遍历程序，这就是我选择antlr的一大优势。